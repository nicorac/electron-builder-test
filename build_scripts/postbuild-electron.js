/**
 * Creates the final "dist" folder by customizing the
 * file layout generated by electron-builder
 */
var fs = require('fs');
const srcParent = './.dist-electron';
const src = srcParent + '/win-unpacked';
const dest = './dist';

// move ./dist/electron-tmp/win-unpacked --> ./dist
if (fs.existsSync(dest)) {
  console.log(`Removing dir: ${dest}`)
  fs.rmdirSync(dest, { recursive: true });
}
fs.renameSync(src, dest);

// keep only some package.json items
const jsonFilename = dest + '/resources/app/package.json';
console.log(`Cleaning file: ${jsonFilename}`)
const srcJson = JSON.parse(fs.readFileSync(jsonFilename));
var newJson = {};
for (prop of [ 'name', 'version', 'main', 'description', 'author', 'homepage', 'copyright' ]) {
  newJson[prop] = srcJson[prop];
}
fs.writeFileSync(jsonFilename, JSON.stringify(newJson, null, 2));

// keep only some locales
const localesPath = dest + '/locales';
const keepLocales = [ 'en-US.pak', 'it.pak' ];
fs.readdirSync(localesPath).forEach(file => {
  const absFilename = localesPath + '/' + file;
  if (keepLocales.indexOf(file) < 0) {
    fs.unlinkSync(absFilename);
  }
});
